<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.png" type="image/png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Browser Compatibility -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />

    <!-- Pi Browser Compatibility -->
    <meta name="pi-app" content="true" />
    <meta name="pi-network" content="mainnet" />
    <meta name="pi-app-name" content="DropLink" />
    <meta name="pi-app-version" content="1.0.0" />

    <!-- Content Security Policy for Pi Browser -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://sdk.minepi.com https://api.minepi.com https://horizon.stellar.org https://idkjfuctyukspexmijvb.supabase.co https://*.supabase.co; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://sdk.minepi.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data: https:; connect-src 'self' https://sdk.minepi.com https://api.minepi.com https://horizon.stellar.org https://idkjfuctyukspexmijvb.supabase.co https://*.supabase.co wss://*.supabase.co; frame-src 'self' https://www.youtube.com https://youtube.com https://www.youtube-nocookie.com https://www.youtube.googleapis.com;" />

    <title>Droplink - Create Your Personal Page &amp; Sell Digital Products</title>
    <meta name="description" content="Create a beautiful link in bio page with all your social links and sell digital products in one place. Simple, clean, and professional.">
    <meta name="author" content="Droplink" />

    <!-- Pi Network SDK -->
    <script src="https://sdk.minepi.com/pi-sdk.js" async crossorigin="anonymous"></script>
      <script>
        // Pi Browser detection helper
        function isPiBrowser() {
          return /PiBrowser/i.test(navigator.userAgent) || (typeof window.Pi !== 'undefined');
        }

        // Initialize Pi SDK only in Pi Browser
        if (isPiBrowser() && typeof Pi !== 'undefined' && Pi.init) {
          Pi.init({ version: "2.0" });
        } else {
          console.warn('Pi SDK not loaded or not available. This app is intended for Pi Browser.');
        }
      </script>

    <!-- Supabase Configuration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
      const SUPABASE_URL = "https://idkjfuctyukspexmijvb.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlka2pmdWN0eXVrc3BleG1panZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0NjI0NzMsImV4cCI6MjA3OTAzODQ3M30.dIJlRYAnSgj2Ohsl6tqz_cP9Zg03HG6naYTGXoAjkDs"; // Replace with your Supabase anon key
      const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // Ensure Pi Network authentication is used
      async function initializeAuth() {
        if (isPiBrowser() && typeof Pi !== 'undefined') {
          try {
            // Use all recommended scopes for full integration
            const scopes = ['payments', 'username', 'wallet_address'];
            const auth = await Pi.authenticate(scopes, (payment) => {
              console.warn('Incomplete payment found:', payment);
              // Optionally, send payment info to backend for completion
            });
            console.log('Pi Network authentication successful:', auth);
            // Optionally, send auth.accessToken to backend for verification
          } catch (error) {
            console.error('Pi Network authentication failed:', error);
          }
        } else {
          console.error('Pi SDK not loaded or not in Pi Browser. Please open in Pi Browser.');
        }
      }

      // Example: Check if Supabase is connected
      async function checkSupabaseConnection() {
        const { data, error } = await supabase.from('test').select('*');
        if (error) {
          console.error('Supabase connection error:', error);
        } else {
          console.log('Supabase connected successfully:', data);
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        initializeAuth();
        checkSupabaseConnection();
      });
    </script>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Additional Pi Browser Meta Tags -->
    <meta name="pi-validation-url" content="https://droplink2920.pinet.com/validation-key.txt" />
    <meta name="pi-app-url" content="https://droplink2920.pinet.com" />
    <meta name="pi-mainnet-ready" content="true" />

    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://storage.googleapis.com/gpt-engineer-file-uploads/ALLayxCo2Zd0m48xGbSaAofsXYf1/social-images/social-1762075342466-Untitled design (8) (1).png">

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://storage.googleapis.com/gpt-engineer-file-uploads/ALLayxCo2Zd0m48xGbSaAofsXYf1/social-images/social-1762075342466-Untitled design (8) (1).png">
    <meta property="og:title" content="Droplink - Create Your Personal Page &amp; Sell Digital Products">
    <meta name="twitter:title" content="Droplink - Create Your Personal Page &amp; Sell Digital Products">
    <meta property="og:description" content="Create a beautiful link in bio page with all your social links and sell digital products in one place. Simple, clean, and professional.">
    <meta name="twitter:description" content="Create a beautiful link in bio page with all your social links and sell digital products in one place. Simple, clean, and professional.">
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
